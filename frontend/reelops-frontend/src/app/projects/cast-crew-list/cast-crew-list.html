<div class="cast-crew-container">
    <div class="header">
        <h3>Cast & Crew</h3>
        <button type="button" *ngIf="canManage" (click)="showAddForm = !showAddForm" class="btn-add-team">
            <span class="btn-icon">+</span>
            {{ showAddForm ? 'Cancel' : 'Add Cast/Crew' }}
        </button>
    </div>

    <div *ngIf="error" class="error-msg">{{ error }}</div>

    <!-- Add Member Form -->
    <div *ngIf="showAddForm" class="add-form-card">
        <h4>Add New Cast/Crew</h4>
        <div class="form-group">
            <label>User Email (Must be registered)</label>
            <input [(ngModel)]="newMember.email" type="email" placeholder="email@example.com" />
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Role Type</label>
                <select [(ngModel)]="newMember.role_type">
                    <option value="cast">Cast</option>
                    <option value="crew">Crew</option>
                </select>
            </div>
            <div class="form-group">
                <label>Position / Character</label>
                <input [(ngModel)]="newMember.position" type="text" placeholder="e.g. Director of Photography" />
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Daily Rate ($)</label>
                <input [(ngModel)]="newMember.daily_rate" type="number" min="0" />
            </div>
            <div class="form-group">
                <label>Notes</label>
                <input [(ngModel)]="newMember.notes" type="text" placeholder="Optional notes" />
            </div>
        </div>

        <button type="button" (click)="addMember()" class="btn-success">Add to Project</button>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
        <div class="spinner"></div> Loading cast/crew...
    </div>

    <!-- Members List -->
    <div class="table-responsive" *ngIf="!isLoading">
        <table class="table">
            <thead>
                <tr>
                    <th>Cast/Crew</th>
                    <th>Role</th>
                    <th>Position</th>
                    <th *ngIf="canManage">Rate</th> <!-- Only producers see rates -->
                    <th>Notes</th>
                    <th *ngIf="canManage">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let m of members">
                    <td>
                        <div class="user-info">
                            <span class="name">{{ m.name }}</span>
                            <span class="email">{{ m.email }}</span>
                        </div>
                    </td>
                    <td>
                        <span class="badge" [class.cast]="m.role_type === 'cast'" [class.crew]="m.role_type === 'crew'">
                            {{ m.role_type | titlecase }}
                        </span>
                    </td>
                    <td>{{ m.position || '-' }}</td>
                    <td *ngIf="canManage">${{ m.daily_rate || 0 }}</td>
                    <td>{{ m.notes || '-' }}</td>
                    <td *ngIf="canManage">
                        <button type="button" (click)="removeMember(m.id)" class="btn-sm btn-danger">Remove</button>
                    </td>
                </tr>
                <tr *ngIf="members.length === 0 && !isLoading">
                    <td [attr.colspan]="canManage ? 6 : 5" class="text-center">No cast/crew added yet.</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>